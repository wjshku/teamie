<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teamie - é¡¹ç›®ç®¡ç†å·¥å…·</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: #fff;
            color: #333;
            line-height: 1.5;
        }
        
        .container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        /* å·¦ä¾§å¯¼èˆªæ  */
        .sidebar {
            width: 200px;
            border-right: 1px solid #ddd;
            background: #f8f8f8;
            padding: 24px 0;
            display: flex;
            flex-direction: column;
        }
        
        .logo {
            font-weight: 700;
            font-size: 16px;
            padding: 0 20px;
            margin-bottom: 30px;
            letter-spacing: 1px;
        }
        
        .nav-item {
            padding: 12px 20px;
            margin: 0 10px;
            cursor: pointer;
            border: 1px solid transparent;
            border-radius: 4px;
            font-size: 13px;
            transition: all 0.2s ease;
            color: #555;
        }
        
        .nav-item:hover {
            background: #eee;
            color: #333;
        }
        
        .nav-item.active {
            background: #fff;
            border: 1px solid #333;
            color: #333;
            font-weight: 600;
        }
        
        .project-info {
            margin-top: auto;
            padding: 20px;
            border-top: 1px solid #ddd;
            font-size: 11px;
            color: #999;
        }
        
        /* ä¸»å†…å®¹åŒº */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .header {
            border-bottom: 1px solid #ddd;
            padding: 16px 24px;
            background: #fafafa;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h2 {
            font-size: 18px;
            font-weight: 600;
        }
        
        .header-right {
            display: flex;
            gap: 12px;
            align-items: center;
            font-size: 12px;
            color: #999;
        }
        
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }
        
        /* Tab æ ·å¼ */
        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 12px;
        }
        
        .tab-btn {
            padding: 8px 16px;
            border: none;
            background: none;
            color: #999;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s ease;
            border-bottom: 2px solid transparent;
            margin-bottom: -14px;
            font-weight: 500;
        }
        
        .tab-btn:hover {
            color: #333;
        }
        
        .tab-btn.active {
            color: #333;
            border-bottom-color: #333;
        }
        
        /* å±å¹•æ ·å¼ */
        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }
        
        /* æŒ‰é’® */
        .btn {
            padding: 10px 20px;
            border: 1px solid #333;
            background: #fff;
            color: #333;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
            border-radius: 4px;
            display: inline-block;
        }
        
        .btn:hover {
            background: #f0f0f0;
        }
        
        .btn.primary {
            background: #333;
            color: #fff;
            border-color: #333;
        }
        
        .btn.primary:hover {
            background: #555;
            border-color: #555;
        }
        
        /* å¡ç‰‡ç»„ä»¶ */
        .card {
            border: 1px solid #ddd;
            padding: 16px;
            margin-bottom: 16px;
            background: #fff;
            border-radius: 4px;
        }
        
        .card-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        /* ç½‘æ ¼å¸ƒå±€ */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }
        
        /* è¡¨æ ¼ */
        .table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .table thead {
            background: #f5f5f5;
            border-bottom: 1px solid #ddd;
        }
        
        .table th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #333;
        }

        .table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
        }

        /* é¡¹ç›®åˆ—è¡¨è¡¨æ ¼åˆ—å®½è®¾ç½® */
        #screen4 .table {
            table-layout: fixed;
        }

        #screen4 .table th:nth-child(1),
        #screen4 .table td:nth-child(1) {
            width: 30%;
        }

        #screen4 .table th:nth-child(2),
        #screen4 .table td:nth-child(2) {
            width: 10%;
        }

        #screen4 .table th:nth-child(3),
        #screen4 .table td:nth-child(3) {
            width: 60%;
        }

        #screen4 .table th:nth-child(4),
        #screen4 .table td:nth-child(4) {
            width: 40px;
        }
        
        .table tbody tr:hover {
            background: #fafafa;
            cursor: pointer;
        }

        /* é¡¹ç›®è¡Œæ ·å¼ */
        .project-row {
            position: relative;
        }

        .project-actions {
            width: 40px;
            text-align: center;
            opacity: 0;
            transition: opacity 0.15s ease;
        }

        .project-row:hover .project-actions {
            opacity: 1;
        }

        .delete-btn {
            background: none;
            border: none;
            color: #999;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 3px;
            transition: all 0.15s ease;
            line-height: 1;
        }

        .delete-btn:hover {
            background: rgba(235, 87, 87, 0.1);
            color: #eb5757;
        }

        /* çŠ¶æ€å•å…ƒæ ¼æ ·å¼ */
        .status-cell {
            cursor: pointer;
            padding: 8px 12px;
            transition: all 0.15s ease;
            border-radius: 4px;
            position: relative;
        }

        .status-cell:hover {
            background: rgba(55, 53, 47, 0.08);
        }

        .status-cell.editing {
            outline: none;
            border: none;
            background: transparent;
            cursor: text;
            padding: 8px 12px;
            margin: 0;
            font-family: inherit;
            font-size: inherit;
            line-height: inherit;
            color: inherit;
            box-sizing: border-box;
            min-height: 1.2em;
        }

        .status-input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            font-family: inherit;
            box-sizing: border-box;
            background: #fff;
        }

        .status-input:focus {
            outline: none;
            border-color: #333;
            box-shadow: 0 0 0 2px rgba(51, 51, 51, 0.1);
        }

        /* ä»»åŠ¡åˆ—è¡¨è¡¨æ ¼æ ·å¼ */
        .task-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            margin-top: 8px;
        }

        .task-table th {
            background: #f8f8f8;
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border: 1px solid #ddd;
            border-bottom: 2px solid #bbb;
        }

        .task-table td {
            padding: 10px 12px;
            border: 1px solid #ddd;
            vertical-align: top;
            background: #fff;
        }

        .task-table tr:nth-child(even) td {
            background: #fafafa;
        }

        .task-table tr:hover td {
            background: #f0f0f0;
        }

        .task-table .task-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
        }

        .task-table .task-desc {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            font-size: 12px;
            color: #555;
            line-height: 1.5;
            font-weight: 400;
        }

        .task-table .priority-badge {
            display: inline-block;
            padding: 2px 6px;
            background: #333;
            color: #fff;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 600;
        }

        /* ç»´åº¦æ§åˆ¶æ ·å¼ */
        .dimension-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            padding: 12px;
            background: #f8f8f8;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .dimension-controls.hidden {
            display: none;
        }

        /* ç»´åº¦åˆ‡æ¢æŒ‰é’®æ ·å¼ */
        .dimension-toggle-btn {
            margin-left: auto;
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            color: #666;
            transition: all 0.2s;
        }

        .dimension-toggle-btn:hover {
            background: #f0f0f0;
            color: #333;
        }

        .dimension-toggle {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .dimension-toggle:hover {
            background: #f0f0f0;
        }

        .dimension-toggle.active {
            background: #333;
            color: #fff;
            border-color: #333;
        }

        .dimension-toggle.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Zå­—å‹å¸ƒå±€ - ä¸¤åˆ— */
        .report-flex {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
        }

        .report-section {
            flex: 0 0 calc(50% - 8px);
            min-width: 300px;
            position: relative;
        }

        /* å½“æœ‰3ä¸ªå…ƒç´ æ—¶ï¼Œæœ€åä¸€ä¸ªå…ƒç´ ä¹Ÿåªå 50%å®½åº¦ */
        .report-section:nth-child(3):last-child,
        .report-section:nth-child(5):last-child,
        .report-section:nth-child(7):last-child {
            flex: 0 0 calc(50% - 8px);
            margin-left: calc(25% + 8px); /* å±…ä¸­æ˜¾ç¤º */
        }

        .report-section.hidden {
            display: none;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }

        /* åé¦ˆæŒ‰é’®æ ·å¼ - ChatGPT é£æ ¼ */
        .feedback-buttons {
            position: absolute;
            bottom: 12px;
            right: 12px;
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .report-section:hover .feedback-buttons {
            opacity: 1;
        }

        .feedback-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            padding: 2px;
            opacity: 0.4;
        }

        .feedback-btn:hover {
            opacity: 0.7;
        }

        .feedback-btn.liked,
        .feedback-btn.disliked {
            opacity: 1;
        }

        .feedback-btn svg {
            width: 18px;
            height: 18px;
        }

        .feedback-toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.1);
            color: #6b7280;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            z-index: 9999;
            animation: slideDown 2s ease-in-out;
            pointer-events: none;
            backdrop-filter: blur(10px);
        }

        @keyframes slideDown {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(-10px);
            }
            10% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            90% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateX(-50%) translateY(-10px);
            }
        }

        /* è¾¾æˆäº‹é¡¹è¡¨æ ¼åˆ—å®½ */
        #completed-tasks .task-table th:nth-child(1),
        #completed-tasks .task-table td:nth-child(1) {
            width: 30%;
        }
        #completed-tasks .task-table th:nth-child(2),
        #completed-tasks .task-table td:nth-child(2) {
            width: 70%;
        }

        /* æœªè¾¾æˆäº‹é¡¹è¡¨æ ¼åˆ—å®½ */
        #not-completed-tasks .task-table th:nth-child(1),
        #not-completed-tasks .task-table td:nth-child(1) {
            width: 30%;
        }
        #not-completed-tasks .task-table th:nth-child(2),
        #not-completed-tasks .task-table td:nth-child(2) {
            width: 30%;
        }
        #not-completed-tasks .task-table th:nth-child(3),
        #not-completed-tasks .task-table td:nth-child(3) {
            width: 40%;
        }

        /* ä¸‹ä¸€æ­¥è®¡åˆ’è¡¨æ ¼åˆ—å®½ */
        #next-steps-list .task-table th:nth-child(1),
        #next-steps-list .task-table td:nth-child(1) {
            width: 10%;
            text-align: center;
        }
        #next-steps-list .task-table th:nth-child(2),
        #next-steps-list .task-table td:nth-child(2) {
            width: 30%;
        }
        #next-steps-list .task-table th:nth-child(3),
        #next-steps-list .task-table td:nth-child(3) {
            width: 60%;
        }

        
        /* ä¸Šä¼ åŒºåŸŸ */
        .upload-area {
            border: 2px dashed #ccc;
            padding: 40px;
            text-align: center;
            border-radius: 4px;
            background: #fafafa;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 16px;
        }
        
        .upload-area:hover {
            border-color: #333;
            background: #f5f5f5;
        }
        
        .upload-area p {
            font-size: 13px;
            color: #666;
            margin-bottom: 4px;
        }
        
        .upload-area small {
            font-size: 11px;
            color: #999;
        }
        
        /* æ•°æ®é¡¹ */
        .data-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 12px;
        }
        
        .data-item:last-child {
            border-bottom: none;
        }
        
        .data-label {
            color: #999;
        }
        
        .data-value {
            font-weight: 500;
            color: #333;
        }
        
        /* çŠ¶æ€æŒ‡ç¤º */
        .status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .status.completed {
            background: #f0f0f0;
            color: #666;
        }
        
        .status.processing {
            background: #fffbf0;
            color: #d97706;
        }
        
        /* æ–‡æœ¬ */
        .text-muted {
            color: #999;
            font-size: 11px;
        }
        
        .text-highlight {
            font-weight: 600;
            color: #333;
        }
        
        /* å‘¨æœŸå¯¼èˆª */
        .week-nav {
            display: flex;
            gap: 16px;
            justify-content: center;
            align-items: center;
            margin-bottom: 24px;
            font-size: 13px;
        }

        .week-nav a {
            color: #666;
            text-decoration: none;
            cursor: pointer;
            font-weight: 500;
            transition: color 0.2s;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .week-nav a:hover {
            color: #333;
            background: #f0f0f0;
        }

        .week-current {
            font-weight: 600;
            min-width: 60px;
            text-align: center;
            color: #333;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #ddd;
            border-top-color: #333;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* ç¼–è¾‘æ¨¡å¼æ ·å¼ - å‚è€ƒ Notion */
        .edit-mode {
            background: #fafafa;
        }

        .editable-row {
            position: relative;
            padding: 4px 8px;
            margin: 2px 0;
            border-radius: 3px;
            transition: background-color 0.15s ease;
        }

        .editable-row:hover {
            background: rgba(55, 53, 47, 0.08);
        }

        .editable-row.selected {
            background: rgba(55, 53, 47, 0.12);
            box-shadow: 0 0 0 1px rgba(55, 53, 47, 0.2);
        }

        .editable-text {
            cursor: text;
            outline: none;
            border: none;
            background: transparent;
            padding: 0;
            margin: 0;
            font-family: inherit;
            font-size: inherit;
            line-height: inherit;
            color: inherit;
            min-height: 20px;
            width: 100%;
        }

        .editable-text:focus {
            outline: none;
        }

        .editable-text:empty::before {
            content: attr(data-placeholder);
            color: rgba(55, 53, 47, 0.4);
            font-style: normal;
        }

        .row-actions {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            display: none;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.15s ease;
        }

        .edit-mode .editable-row:hover .row-actions,
        .edit-mode .editable-row.selected .row-actions {
            display: flex;
            opacity: 1;
        }

        .row-action-btn {
            width: 24px;
            height: 24px;
            border: none;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
            color: rgba(55, 53, 47, 0.6);
        }

        .row-action-btn:hover {
            background: rgba(55, 53, 47, 0.1);
            color: rgba(55, 53, 47, 0.8);
        }

        .row-action-btn.delete:hover {
            background: rgba(235, 87, 87, 0.1);
            color: rgb(235, 87, 87);
        }

        .add-row-btn {
            width: 100%;
            padding: 8px;
            margin: 4px 0;
            border: 1px dashed rgba(55, 53, 47, 0.2);
            background: transparent;
            border-radius: 3px;
            cursor: pointer;
            color: rgba(55, 53, 47, 0.6);
            transition: all 0.15s ease;
            font-size: 12px;
            display: none;
        }

        .edit-mode .add-row-btn {
            display: block;
        }

        .add-row-btn:hover {
            border-color: rgba(55, 53, 47, 0.3);
            background: rgba(55, 53, 47, 0.05);
            color: rgba(55, 53, 47, 0.8);
        }

        /* ç©ºçŠ¶æ€æ ·å¼ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state h3 {
            margin-bottom: 12px;
            color: #666;
        }

        .empty-state p {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å·¦ä¾§å¯¼èˆª -->
        <div class="sidebar">
            <div class="logo">Teamie</div>
            <div class="nav-item" onclick="switchNav('import')">å¯¼å…¥æ–°é¡¹ç›®</div>
            <div class="nav-item active" onclick="switchNav('dashboard')">æŸ¥çœ‹é¡¹ç›®è¿›å±•</div>
            <div class="project-info" id="projectInfo" style="display: none;">
                å½“å‰é¡¹ç›®: <span id="currentProject">æœªé€‰æ‹©é¡¹ç›®</span><br/>
                <span id="currentPeriod">2025-11-03 è‡³ 2025-11-09</span>
            </div>
        </div>
        
        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main">
            <div class="header">
                <h2 id="screenTitle">é¡¹ç›®è¿›å±•ä¸€è§ˆ</h2>
                <div class="header-right">
                    <span id="headerInfo"></span>
                </div>
            </div>
            
            <div class="content">
                <!-- å±å¹• 1: å¯¼å…¥é¡µé¢ -->
                <div id="screen1" class="screen" style="display: none;">
                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchScreen(1)">ä¸Šä¼ æ–‡ä»¶</button>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">é€‰æ‹© Notion HTML æ–‡ä»¶</div>
                        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                            <p>ğŸ“ æ‹–æ‹½æ–‡ä»¶æˆ–ç‚¹å‡»é€‰æ‹©</p>
                            <small>æ”¯æŒ Notion å¯¼å‡ºçš„ HTML æ–‡ä»¶ï¼ˆå«å­é¡µé¢ï¼‰</small>
                            <input type="file" id="fileInput" style="display: none;" accept=".html">
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-title">é¡¹ç›®ä¿¡æ¯</div>
                        <div class="grid-2">
                            <div>
                                <label for="projectName" style="display: block; font-size: 12px; font-weight: 600; color: #333; margin-bottom: 8px;">é¡¹ç›®åç§°</label>
                                <input type="text" id="projectName" placeholder="è¾“å…¥é¡¹ç›®åç§°" style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; box-sizing: border-box;">
                            </div>
                            <div>
                                <label for="weekStartDate" style="display: block; font-size: 12px; font-weight: 600; color: #333; margin-bottom: 8px;">æœ¬å‘¨å¼€å§‹æ—¥æœŸï¼ˆå‘¨ä¸€ï¼‰</label>
                                <input type="date" id="weekStartDate" style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; box-sizing: border-box;">
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">æ–‡ä»¶çŠ¶æ€</div>
                        <div class="data-item">
                            <span class="data-label">å½“å‰æ–‡ä»¶</span>
                            <span class="data-value" id="fileName">æœªé€‰æ‹©</span>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 12px;">
                        <button class="btn primary" onclick="handleUpload()">ä¸Šä¼ å¹¶åˆ†æ</button>
                        <button class="btn" onclick="cancelImport()">å–æ¶ˆ</button>
                    </div>
                </div>
                
                <!-- å±å¹• 2: åˆ†æè¿›è¡Œä¸­ -->
                <div id="screen2" class="screen" style="display: none;">
                    <div style="text-align: center; padding: 60px 20px;">
                        <div class="spinner" style="margin: 0 auto 20px;"></div>
                        <h3 style="margin-bottom: 10px;">å¤„ç†ä¸­...</h3>
                        <p class="text-muted">æ­£åœ¨è§£ææ‚¨çš„ Notion æ–‡ä»¶</p>
                        
                        <div class="card" style="margin-top: 30px; text-align: left;">
                            <div class="data-item">
                                <span class="data-label">å·²è¯†åˆ«é¡µé¢</span>
                                <span class="data-value">12</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">å·²è¯†åˆ«ä»»åŠ¡</span>
                                <span class="data-value">28</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">æ—¥æœŸèŒƒå›´</span>
                                <span class="data-value">2025-11-01 ~ 2025-11-07</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">é¢„è®¡å®Œæˆ</span>
                                <span class="data-value">20 ç§’</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- å±å¹• 3: è¿›å±•æ±‡æŠ¥ -->
                <div id="screen3" class="screen" style="display: none;">
                    <div class="week-nav">
                        <a onclick="changeWeek(-1)">â† ä¸Šä¸€å‘¨</a>
                        <span class="week-current">ç¬¬ 1 å‘¨</span>
                        <a onclick="changeWeek(1)">ä¸‹ä¸€å‘¨ â†’</a>
                        <button class="btn primary" onclick="showScreen('screen1')">å¯¼å…¥æ–°è¿›å±•</button>
                        <button class="btn" onclick="toggleEditMode()" id="editBtn">ç¼–è¾‘å†…å®¹</button>
                        <button class="btn" onclick="saveAllEdits()" id="saveBtn" style="display: none;">ä¿å­˜ä¿®æ”¹</button>
                        <button class="dimension-toggle-btn" onclick="toggleDimensionControls()">è‡ªå®šä¹‰è§†å›¾</button>
                    </div>

                    <!-- ç»´åº¦æ§åˆ¶ -->
                    <div class="dimension-controls hidden">
                        <button class="dimension-toggle active" data-section="motivation" onclick="toggleDimension(this)">åŠ¨æœºä¸æ–¹å‘</button>
                        <button class="dimension-toggle active" data-section="completed" onclick="toggleDimension(this)">è¾¾æˆäº‹é¡¹</button>
                        <button class="dimension-toggle active" data-section="incomplete" onclick="toggleDimension(this)">æœªè¾¾æˆäº‹é¡¹</button>
                        <button class="dimension-toggle" data-section="internal" onclick="toggleDimension(this)">å†…éƒ¨åæ€</button>
                        <button class="dimension-toggle" data-section="external" onclick="toggleDimension(this)">å¤–éƒ¨åé¦ˆ</button>
                        <button class="dimension-toggle active" data-section="next-steps" onclick="toggleDimension(this)">ä¸‹ä¸€æ­¥è®¡åˆ’</button>
                    </div>

                    <!-- Zå­—å‹å¸ƒå±€ï¼šåŠ¨æœºä¸æ–¹å‘ â†’ å®Œæˆäº‹é¡¹ â†’ æœªå®Œæˆäº‹é¡¹ â†’ å†…éƒ¨åé¦ˆ â†’ å¤–éƒ¨åé¦ˆ â†’ ä¸‹ä¸€æ­¥è®¡åˆ’ -->
                    <div class="report-flex">
                        <!-- ç¬¬ä¸€è¡Œï¼šåŠ¨æœºä¸æ–¹å‘ -->
                        <div class="report-section" data-section="motivation">
                            <div class="section-title">åŠ¨æœºä¸æ–¹å‘</div>
                            <div id="reasons-list"></div>
                            <div id="feedback-motivation" class="feedback-buttons"></div>
                        </div>

                        <!-- ç¬¬äºŒè¡Œï¼šè¾¾æˆäº‹é¡¹ -->
                        <div class="report-section" data-section="completed">
                            <div class="section-title">è¾¾æˆäº‹é¡¹</div>
                            <div id="completed-tasks"></div>
                            <div class="text-muted" id="completed-count" style="padding-top: 8px;"></div>
                            <div id="feedback-completed" class="feedback-buttons"></div>
                        </div>

                        <!-- ç¬¬ä¸‰è¡Œï¼šæœªè¾¾æˆäº‹é¡¹ -->
                        <div class="report-section" data-section="incomplete">
                            <div class="section-title">æœªè¾¾æˆäº‹é¡¹</div>
                            <div id="not-completed-tasks"></div>
                            <div class="text-muted" id="not-completed-count" style="padding-top: 8px;"></div>
                            <div id="feedback-incomplete" class="feedback-buttons"></div>
                        </div>

                        <!-- ç¬¬å››è¡Œï¼šå†…éƒ¨åæ€ -->
                        <div class="report-section hidden" data-section="internal">
                            <div class="section-title">å†…éƒ¨åæ€</div>
                            <div id="why-not-list"></div>
                            <div id="feedback-internal" class="feedback-buttons"></div>
                        </div>

                        <!-- ç¬¬äº”è¡Œï¼šå¤–éƒ¨åé¦ˆ -->
                        <div class="report-section hidden" data-section="external">
                            <div class="section-title">å¤–éƒ¨åé¦ˆ</div>
                            <div id="achievements-list"></div>
                            <div id="feedback-external" class="feedback-buttons"></div>
                        </div>

                        <!-- ç¬¬å…­è¡Œï¼šä¸‹ä¸€æ­¥è®¡åˆ’ -->
                        <div class="report-section" data-section="next-steps">
                            <div class="section-title">ä¸‹ä¸€æ­¥è®¡åˆ’</div>
                            <div id="next-steps-list"></div>
                            <div id="feedback-next-steps" class="feedback-buttons"></div>
                        </div>
                    </div>
                </div>
                
                <!-- å±å¹• 4: é¡¹ç›®åˆ—è¡¨ -->
                <div id="screen4" class="screen active" style="display: block;">
                    <div style="margin-bottom: 16px;">
                        <div id="project-stats" style="font-size: 12px; color: #666;"></div>
                    </div>

                    <table class="table">
                        <thead>
                            <tr>
                                <th>é¡¹ç›®åç§°</th>
                                <th>å½“å‰å‘¨æœŸ</th>
                                <th>çŠ¶æ€ä¸è¯„ä»·</th>
                                <th style="width: 40px;"></th>
                            </tr>
                        </thead>
                        <tbody id="project-list">
                            <!-- é¡¹ç›®æ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // APIé…ç½®
        const API_BASE_URL = 'http://localhost:8000/api';

        // å…¨å±€çŠ¶æ€
        let currentProject = null;
        let currentWeek = 1;
        let isEditMode = false;
        let projects = []; // é¡¹ç›®åˆ—è¡¨

        // APIè°ƒç”¨å‡½æ•°
        async function apiCall(endpoint, options = {}) {
            const url = `${API_BASE_URL}${endpoint}`;
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                },
            };

            try {
                const response = await fetch(url, { ...defaultOptions, ...options });
                if (!response.ok) {
                    throw new Error(`API call failed: ${response.status} ${response.statusText}`);
                }
                return await response.json();
            } catch (error) {
                console.error('API call error:', error);
                throw error;
            }
        }

        // åŠ è½½é¡¹ç›®åˆ—è¡¨
        async function loadProjects() {
            try {
                projects = await apiCall('/projects');
                renderProjectList();
                updateProjectStats();
                return projects;
            } catch (error) {
                console.error('Failed to load projects:', error);
                projects = [];
                renderProjectList();
                updateProjectStats();
                return [];
            }
        }

        // åŠ è½½é¡¹ç›®å‘¨æŠ¥
        async function loadWeekReport(projectId, week) {
            try {
                const report = await apiCall(`/projects/${projectId}/week/${week}`);
                return report;
            } catch (error) {
                console.log(`Week ${week} data not available for project ${projectId}:`, error.message);
                return null;
            }
        }

        // è·å–é¡¹ç›®ä¿¡æ¯
        async function getProjectInfo(projectId) {
            try {
                const projectInfo = await apiCall(`/projects/${projectId}`);
                return projectInfo;
            } catch (error) {
                console.error('Failed to get project info:', error);
                return null;
            }
        }

        // ä¸Šä¼ æ–‡ä»¶
        async function uploadFile(file, projectName, weekStartDate) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('project_name', projectName);
            formData.append('week_start_date', weekStartDate);

            try {
                const response = await fetch(`${API_BASE_URL}/upload`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`Upload failed: ${response.status} ${response.statusText}`);
                }

                return await response.json();
            } catch (error) {
                console.error('Upload error:', error);
                throw error;
            }
        }

        // æ›´æ–°å®Œæ•´å‘¨æŠ¥
        async function updateWeekReport(projectId, week, weekData) {
            try {
                const result = await apiCall(`/projects/${projectId}/week/${week}`, {
                    method: 'PUT',
                    body: JSON.stringify(weekData)
                });
                return result;
            } catch (error) {
                console.error('Failed to update week report:', error);
                throw error;
            }
        }

        // åˆ‡æ¢å¯¼èˆª
        function switchNav(type) {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => item.classList.remove('active'));
            event.target.classList.add('active');

            const projectInfo = document.getElementById('projectInfo');
            if (type === 'dashboard') {
                projectInfo.style.display = 'block';
                showScreen('screen4');
                document.getElementById('screenTitle').textContent = 'é¡¹ç›®è¿›å±•ä¸€è§ˆ';
            } else {
                projectInfo.style.display = 'none';
                showScreen('screen1');
                document.getElementById('screenTitle').textContent = 'å¯¼å…¥æ–°é¡¹ç›®';
            }
        }

        // æ˜¾ç¤ºå±å¹•
        function showScreen(screenId) {
            console.log('Switching to screen:', screenId);
            const screens = document.querySelectorAll('.screen');
            screens.forEach(screen => {
                screen.style.display = 'none';
                screen.classList.remove('active');
            });
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.style.display = 'block';
                targetScreen.classList.add('active');
                console.log('Screen switched successfully:', screenId);

                // å½“åˆ‡æ¢åˆ°å¯¼å…¥é¡µé¢æ—¶ï¼Œè®¾ç½®é»˜è®¤é¡¹ç›®ä¿¡æ¯
                if (screenId === 'screen1') {
                    setDefaultProjectInfo();
                }

                // å½“åˆ‡æ¢åˆ°é¡¹ç›®åˆ—è¡¨æ—¶ï¼Œéšè—é¡¹ç›®ä¿¡æ¯åŒºåŸŸ
                if (screenId === 'screen4') {
                    const projectInfo = document.getElementById('projectInfo');
                    projectInfo.style.display = 'none';
                }
            } else {
                console.error('Screen not found:', screenId);
            }
        }

        // åˆ‡æ¢å±å¹•ï¼ˆå…¼å®¹æ—§ä»£ç ï¼‰
        function switchScreen(num) {
            showScreen('screen' + num);
        }

        // æ¸²æŸ“é¡¹ç›®åˆ—è¡¨
        function renderProjectList() {
            const tbody = document.getElementById('project-list');
            if (!tbody) return;

            if (projects.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 60px 20px; color: #999;">
                            <div class="empty-state">
                                <h3>æš‚æ— é¡¹ç›®</h3>
                                <p>è¯·å…ˆä¸Šä¼  Notion HTML æ–‡ä»¶æ¥å¯¼å…¥é¡¹ç›®</p>
                                <button class="btn primary" onclick="showScreen('screen1')">å¯¼å…¥é¡¹ç›®</button>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = projects.map(project => `
                <tr class="project-row" onclick="selectProject('${project.id}', '${project.name}')">
                    <td><strong>${project.name}</strong></td>
                    <td>ç¬¬ ${project.current_week} å‘¨</td>
                    <td class="status-cell" data-project="${project.id}" onclick="editStatus(this, event)">${project.status}</td>
                    <td class="project-actions">
                        <button class="delete-btn" onclick="deleteProject('${project.id}', '${project.name}', event)" title="åˆ é™¤é¡¹ç›®">Ã—</button>
                    </td>
                </tr>
            `).join('');
        }

        // æ›´æ–°é¡¹ç›®ç»Ÿè®¡ä¿¡æ¯
        function updateProjectStats() {
            const statsElement = document.getElementById('project-stats');
            if (projects.length > 0) {
                statsElement.textContent = `å…± ${projects.length} ä¸ªé¡¹ç›®`;
            } else {
                statsElement.textContent = '';
            }
        }

        // é€‰æ‹©é¡¹ç›®
        async function selectProject(projectId, projectName) {
            console.log('Selecting project:', projectId, projectName);

            // æ‰¾åˆ°é¡¹ç›®ï¼ˆé€šè¿‡IDåŒ¹é…ï¼‰
            const project = projects.find(p => p.id === projectId);
            if (!project) {
                alert('é¡¹ç›®ä¸å­˜åœ¨');
                return;
            }

            currentProject = projectId;  // ä½¿ç”¨é¡¹ç›®IDè€Œä¸æ˜¯åç§°
            currentWeek = project.current_week || 1;

            document.getElementById('currentProject').textContent = projectName;
            document.getElementById('screenTitle').textContent = 'è¿›å±•æ±‡æŠ¥ - ' + projectName;

            try {
                const reportData = await loadWeekReport(projectId, currentWeek);
                if (reportData) {
                    // è®¾ç½®å‘¨æ•°å’Œå·¦ä¸‹è§’çš„æ—¥æœŸæ˜¾ç¤º
                    document.querySelector('.week-current').textContent = 'ç¬¬ ' + currentWeek + ' å‘¨';
                    const currentPeriodElement = document.getElementById('currentPeriod');
                    if (currentPeriodElement) {
                        currentPeriodElement.textContent = reportData.week_period || '2025-11-03 è‡³ 2025-11-09';
                    }

                    renderReport(reportData);

                    // æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯åŒºåŸŸ
                    const projectInfo = document.getElementById('projectInfo');
                    projectInfo.style.display = 'block';

                    showScreen('screen3');
                } else {
                    alert('æœªæ‰¾åˆ°æŠ¥å‘Šæ•°æ®');
                }
            } catch (error) {
                alert('åŠ è½½æŠ¥å‘Šå¤±è´¥: ' + error.message);
            }
        }

        // æ¸²æŸ“æŠ¥å‘Š
        function renderReport(data) {
            // æ¸²æŸ“"åšäº†ä»€ä¹ˆ" (è¾¾æˆäº‹é¡¹)
            const completedTasksContainer = document.getElementById('completed-tasks');
            const completedCountContainer = document.getElementById('completed-count');

            if (completedTasksContainer && data.completed_tasks) {
                if (data.completed_tasks.length > 0) {
                    completedTasksContainer.innerHTML = `
                        <table class="task-table">
                            <thead>
                                <tr>
                                    <th>ä»»åŠ¡åç§°</th>
                                    <th>å®Œæˆæƒ…å†µ</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.completed_tasks.map((task, index) => `
                                    <tr class="editable-row" data-path="completed_tasks" data-index="${index}">
                                        <td>
                                            <div class="task-name editable-text" data-path="completed_tasks" data-index="${index}" data-field="task" data-placeholder="ä»»åŠ¡åç§°">${task.task}</div>
                                        </td>
                                        <td>
                                            <div class="task-desc editable-text" data-path="completed_tasks" data-index="${index}" data-field="description" data-placeholder="ä»»åŠ¡æè¿°">${task.description}</div>
                                        </td>
                                        <td class="row-actions">
                                            <button class="row-action-btn delete" title="åˆ é™¤">Ã—</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        <button class="add-row-btn" data-path="completed_tasks">+ æ·»åŠ å®Œæˆä»»åŠ¡</button>
                    `;
                } else {
                    completedTasksContainer.innerHTML = '<p class="text-muted">æš‚æ— è¾¾æˆäº‹é¡¹</p>';
                }
            }

            if (completedCountContainer && data.completed_tasks) {
                completedCountContainer.textContent = `å…± ${data.completed_tasks.length} ä¸ªä»»åŠ¡å®Œæˆ`;
            }

            // æ¸²æŸ“"ä¸ºä»€ä¹ˆè¿™æ ·åš" (åŠ¨æœºä¸æ–¹å‘)
            const reasonsContainer = document.getElementById('reasons-list');
            if (reasonsContainer && data.motivation_direction) {
                if (data.motivation_direction.length > 0) {
                    reasonsContainer.innerHTML = `
                        ${data.motivation_direction.map((item, index) => `
                            <div class="data-item editable-row" data-path="motivation_direction" data-index="${index}">
                                <span class="editable-text" data-path="motivation_direction" data-index="${index}" data-field="item" data-placeholder="è¾“å…¥åŠ¨æœºæ–¹å‘">${item}</span>
                                <div class="row-actions">
                                    <button class="row-action-btn delete" title="åˆ é™¤">Ã—</button>
                                </div>
                            </div>
                        `).join('')}
                        <button class="add-row-btn" data-path="motivation_direction">+ æ·»åŠ åŠ¨æœºæ–¹å‘</button>
                    `;
                } else {
                    reasonsContainer.innerHTML = '<p class="text-muted">æš‚æ— åŠ¨æœºæ–¹å‘ä¿¡æ¯</p>';
                }
            }

            // æ¸²æŸ“"æ²¡åšä»€ä¹ˆ" (æœªè¾¾æˆäº‹é¡¹)
            const notCompletedTasksContainer = document.getElementById('not-completed-tasks');
            const notCompletedCountContainer = document.getElementById('not-completed-count');

            if (notCompletedTasksContainer && data.incomplete_tasks) {
                if (data.incomplete_tasks.length > 0) {
                    notCompletedTasksContainer.innerHTML = `
                        <table class="task-table">
                            <thead>
                                <tr>
                                    <th>ä»»åŠ¡åç§°</th>
                                    <th>é¢„æœŸç›®æ ‡</th>
                                    <th>æœªå®ŒæˆåŸå› </th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.incomplete_tasks.map((task, index) => `
                                    <tr class="editable-row" data-path="incomplete_tasks" data-index="${index}">
                                        <td>
                                            <div class="task-name editable-text" data-path="incomplete_tasks" data-index="${index}" data-field="task" data-placeholder="ä»»åŠ¡åç§°">${task.task}</div>
                                        </td>
                                        <td>
                                            <div class="task-desc editable-text" data-path="incomplete_tasks" data-index="${index}" data-field="expected" data-placeholder="é¢„æœŸç›®æ ‡">${task.expected}</div>
                                        </td>
                                        <td>
                                            <div class="task-desc editable-text" data-path="incomplete_tasks" data-index="${index}" data-field="reason" data-placeholder="æœªå®ŒæˆåŸå› ">${task.reason}</div>
                                        </td>
                                        <td class="row-actions">
                                            <button class="row-action-btn delete" title="åˆ é™¤">Ã—</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        <button class="add-row-btn" data-path="incomplete_tasks">+ æ·»åŠ æœªå®Œæˆä»»åŠ¡</button>
                    `;
                    if (notCompletedCountContainer) {
                        notCompletedCountContainer.textContent = `${data.incomplete_tasks.length} ä¸ªä»»åŠ¡æœªå®Œæˆ`;
                    }
                } else {
                    notCompletedTasksContainer.innerHTML = '<p class="text-muted">æš‚æ— æœªå®Œæˆä»»åŠ¡</p>';
                    if (notCompletedCountContainer) {
                        notCompletedCountContainer.textContent = '';
                    }
                }
            }

            // æ¸²æŸ“"ä¸ºä»€ä¹ˆæ²¡åš" (å†…éƒ¨åæ€)
            const whyNotContainer = document.getElementById('why-not-list');
            if (whyNotContainer && data.internal_reflection) {
                if (data.internal_reflection.length > 0) {
                    whyNotContainer.innerHTML = `
                        ${data.internal_reflection.map((item, index) => `
                            <div class="data-item editable-row" data-path="internal_reflection" data-index="${index}">
                                <span class="editable-text" data-path="internal_reflection" data-index="${index}" data-field="item" data-placeholder="è¾“å…¥å†…éƒ¨åæ€">${item}</span>
                                <div class="row-actions">
                                    <button class="row-action-btn delete" title="åˆ é™¤">Ã—</button>
                                </div>
                            </div>
                        `).join('')}
                        <button class="add-row-btn" data-path="internal_reflection">+ æ·»åŠ å†…éƒ¨åæ€</button>
                    `;
                } else {
                    whyNotContainer.innerHTML = '<p class="text-muted">æš‚æ— å†…éƒ¨åæ€</p>';
                }
            }

            // æ¸²æŸ“"æˆæ•ˆä¸åé¦ˆ" (å¤–éƒ¨åé¦ˆ)
            const achievementsContainer = document.getElementById('achievements-list');
            if (achievementsContainer && data.external_feedback) {
                if (data.external_feedback.length > 0) {
                    achievementsContainer.innerHTML = `
                        ${data.external_feedback.map((feedback, index) => `
                            <div class="data-item editable-row" data-path="external_feedback" data-index="${index}">
                                <div class="task-name editable-text" data-path="external_feedback" data-index="${index}" data-field="source" data-placeholder="åé¦ˆæ¥æº">${feedback.source}</div>
                                <div class="task-desc editable-text" data-path="external_feedback" data-index="${index}" data-field="content" data-placeholder="åé¦ˆå†…å®¹">${feedback.content}</div>
                                <div class="row-actions">
                                    <button class="row-action-btn delete" title="åˆ é™¤">Ã—</button>
                                </div>
                            </div>
                        `).join('')}
                        <button class="add-row-btn" data-path="external_feedback">+ æ·»åŠ å¤–éƒ¨åé¦ˆ</button>
                    `;
                } else {
                    achievementsContainer.innerHTML = '<p class="text-muted">æš‚æ— å¤–éƒ¨åé¦ˆ</p>';
                }
            }

            // æ¸²æŸ“"ä¸‹ä¸€æ­¥è®¡åˆ’"
            const nextStepsContainer = document.getElementById('next-steps-list');
            if (nextStepsContainer && data.next_week_plan) {
                if (data.next_week_plan.length > 0) {
                    nextStepsContainer.innerHTML = `
                        <table class="task-table">
                            <thead>
                                <tr>
                                    <th>ä¼˜å…ˆçº§</th>
                                    <th>ä»»åŠ¡åç§°</th>
                                    <th>ç›®æ ‡</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.next_week_plan.map((plan, index) => `
                                    <tr class="editable-row" data-path="next_week_plan" data-index="${index}">
                                        <td>
                                            <span class="priority-badge editable-text" data-path="next_week_plan" data-index="${index}" data-field="priority" data-placeholder="P1">${typeof plan.priority === 'string' && plan.priority.startsWith('P') ? plan.priority : 'P' + (plan.priority || 1)}</span>
                                        </td>
                                        <td>
                                            <div class="task-name editable-text" data-path="next_week_plan" data-index="${index}" data-field="task" data-placeholder="ä»»åŠ¡åç§°">${plan.task || ''}</div>
                                        </td>
                                        <td>
                                            <div class="task-desc editable-text" data-path="next_week_plan" data-index="${index}" data-field="goal" data-placeholder="ç›®æ ‡æè¿°">${plan.goal || ''}</div>
                                        </td>
                                        <td class="row-actions">
                                            <button class="row-action-btn delete" title="åˆ é™¤">Ã—</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        <button class="add-row-btn" data-path="next_week_plan">+ æ·»åŠ ä¸‹ä¸€æ­¥è®¡åˆ’</button>
                    `;
                } else {
                    nextStepsContainer.innerHTML = '<p class="text-muted">æš‚æ— ä¸‹ä¸€æ­¥è®¡åˆ’</p>';
                }
            }

            // åˆå§‹åŒ–åé¦ˆæŒ‰é’®
            initializeFeedbackButtons();
        }

        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        async function handleUpload() {
            console.log('handleUpload called');
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            const projectNameInput = document.getElementById('projectName');
            const weekStartDateInput = document.getElementById('weekStartDate');

            if (!file) {
                alert('è¯·å…ˆé€‰æ‹©æ–‡ä»¶');
                return;
            }

            const projectName = projectNameInput.value.trim();
            if (!projectName) {
                alert('è¯·è¾“å…¥é¡¹ç›®åç§°');
                projectNameInput.focus();
                return;
            }

            const weekStartDate = weekStartDateInput.value;
            if (!weekStartDate) {
                alert('è¯·é€‰æ‹©æœ¬å‘¨å¼€å§‹æ—¥æœŸ');
                weekStartDateInput.focus();
                return;
            }

            document.getElementById('fileName').textContent = file.name;
            showScreen('screen2');

            try {
                const result = await uploadFile(file, projectName, weekStartDate);

                if (result.success) {
                    alert('å¯¼å…¥æˆåŠŸï¼');
                    // æ¸…ç©ºè¾“å…¥æ¡†
                    projectNameInput.value = '';
                    // é‡æ–°åŠ è½½é¡¹ç›®åˆ—è¡¨
                    await loadProjects();
                    showScreen('screen4');
                    document.getElementById('screenTitle').textContent = 'é¡¹ç›®è¿›å±•ä¸€è§ˆ';
                } else {
                    throw new Error(result.message || 'ä¸Šä¼ å¤±è´¥');
                }
            } catch (error) {
                alert('ä¸Šä¼ å¤±è´¥: ' + error.message);
                showScreen('screen1');
            }
        }

        // åˆ é™¤é¡¹ç›®
        async function deleteProject(projectId, projectName, event) {
            event.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé¿å…è§¦å‘è¡Œç‚¹å‡»

            if (!confirm(`ç¡®å®šè¦åˆ é™¤é¡¹ç›®"${projectName}"å—ï¼Ÿ\n\nè¿™å°†æ°¸ä¹…åˆ é™¤è¯¥é¡¹ç›®çš„æ‰€æœ‰æ•°æ®ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`)) {
                return;
            }

            try {
                // è°ƒç”¨åˆ é™¤API
                await apiCall(`/projects/${projectId}`, {
                    method: 'DELETE'
                });

                alert('é¡¹ç›®åˆ é™¤æˆåŠŸ');
                // é‡æ–°åŠ è½½é¡¹ç›®åˆ—è¡¨
                await loadProjects();
            } catch (error) {
                console.error('åˆ é™¤é¡¹ç›®å¤±è´¥:', error);
                alert('åˆ é™¤é¡¹ç›®å¤±è´¥: ' + error.message);
            }
        }

        // å–æ¶ˆå¯¼å…¥
        function cancelImport() {
            console.log('cancelImport called');

            // éšè—é¡¹ç›®ä¿¡æ¯åŒºåŸŸ
            const projectInfo = document.getElementById('projectInfo');
            projectInfo.style.display = 'none';

            showScreen('screen4');
            document.getElementById('screenTitle').textContent = 'é¡¹ç›®è¿›å±•ä¸€è§ˆ';
        }

        // è·å–æœ¬å‘¨ä¸€çš„æ—¥æœŸ
        function getThisMonday() {
            const today = new Date();
            const dayOfWeek = today.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
            const diff = today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1); // è°ƒæ•´ä¸ºå‘¨ä¸€
            const monday = new Date(today.setDate(diff));
            return monday.toISOString().split('T')[0]; // è¿”å›YYYY-MM-DDæ ¼å¼
        }

        // è®¾ç½®é»˜è®¤é¡¹ç›®ä¿¡æ¯
        function setDefaultProjectInfo() {
            const weekStartDateInput = document.getElementById('weekStartDate');
            if (weekStartDateInput) {
                weekStartDateInput.value = getThisMonday();
            }

            const projectNameInput = document.getElementById('projectName');
            if (projectNameInput) {
                projectNameInput.value = '';
                projectNameInput.focus();
            }
        }

        // æ”¹å˜å‘¨æ•°
        async function changeWeek(direction) {
            console.log('Changing week, direction:', direction);
            const current = parseInt(document.querySelector('.week-current').textContent.match(/\d+/)[0]);
            const newWeek = current + direction;

            // å…ˆè·å–é¡¹ç›®ä¿¡æ¯æ¥æ£€æŸ¥è¾¹ç•Œ
            const projectInfo = await getProjectInfo(currentProject);
            if (!projectInfo) {
                alert('æ— æ³•è·å–é¡¹ç›®ä¿¡æ¯');
                return;
            }

            const maxWeek = projectInfo.total_weeks;

            // æ£€æŸ¥è¾¹ç•Œ
            if (newWeek < 1) {
                alert('å·²ç»æ˜¯ç¬¬ä¸€å‘¨æ•°æ®');
                return;
            }

            if (newWeek > maxWeek) {
                alert('æš‚æ— ä¸‹ä¸€å‘¨æ•°æ®');
                return;
            }

            try {
                const reportData = await loadWeekReport(currentProject, newWeek);
                if (reportData) {
                    currentWeek = newWeek;
                    document.querySelector('.week-current').textContent = 'ç¬¬ ' + newWeek + ' å‘¨';

                    // æ›´æ–°å·¦ä¸‹è§’çš„æ—¥æœŸæ˜¾ç¤º
                    const currentPeriodElement = document.getElementById('currentPeriod');
                    if (currentPeriodElement) {
                        currentPeriodElement.textContent = reportData.week_period || '2025-11-03 è‡³ 2025-11-09';
                    }

                    renderReport(reportData);
                    console.log('Week changed to:', newWeek);
                } else {
                    alert('è¯¥å‘¨æ•°æ®åŠ è½½å¤±è´¥');
                }
            } catch (error) {
                console.log('Unexpected error loading week:', newWeek, 'Error:', error.message);
                alert('æ•°æ®åŠ è½½å‡ºé”™ï¼Œè¯·é‡è¯•');
            }
        }

        // åˆ‡æ¢ç¼–è¾‘æ¨¡å¼
        function toggleEditMode() {
            isEditMode = !isEditMode;
            const editBtn = document.getElementById('editBtn');
            const saveBtn = document.getElementById('saveBtn');
            const container = document.querySelector('.container');

            if (isEditMode) {
                editBtn.textContent = 'é€€å‡ºç¼–è¾‘';
                editBtn.classList.add('primary');
                saveBtn.style.display = 'inline-block';
                container.classList.add('edit-mode');
                enableInlineEditing();
            } else {
                editBtn.textContent = 'ç¼–è¾‘å†…å®¹';
                editBtn.classList.remove('primary');
                saveBtn.style.display = 'none';
                container.classList.remove('edit-mode');
                disableInlineEditing();
            }
        }

        // ä¿å­˜æ‰€æœ‰ç¼–è¾‘
        async function saveAllEdits() {
            if (!currentProject) {
                alert('è¯·å…ˆé€‰æ‹©é¡¹ç›®');
                return;
            }

            try {
                const weekData = collectCurrentWeekData();
                await updateWeekReport(currentProject, currentWeek, weekData);
                alert('ä¿å­˜æˆåŠŸï¼');
            } catch (error) {
                alert('ä¿å­˜å¤±è´¥: ' + error.message);
            }
        }

        // æ”¶é›†å½“å‰é¡µé¢æ•°æ®
        function collectCurrentWeekData() {
            const data = {
                completed_tasks: [],
                incomplete_tasks: [],
                motivation_direction: [],
                internal_reflection: [],
                external_feedback: [],
                next_week_plan: []
            };

            // æ”¶é›†è¾¾æˆäº‹é¡¹
            const completedTaskRows = document.querySelectorAll('#completed-tasks .editable-row');
            completedTaskRows.forEach(row => {
                const task = row.querySelector('[data-field="task"]')?.textContent || '';
                const description = row.querySelector('[data-field="description"]')?.textContent || '';
                if (task.trim()) {
                    data.completed_tasks.push({ task: task.trim(), description: description.trim() });
                }
            });

            // æ”¶é›†æœªè¾¾æˆäº‹é¡¹
            const incompleteTaskRows = document.querySelectorAll('#not-completed-tasks .editable-row');
            incompleteTaskRows.forEach(row => {
                const task = row.querySelector('[data-field="task"]')?.textContent || '';
                const expected = row.querySelector('[data-field="expected"]')?.textContent || '';
                const reason = row.querySelector('[data-field="reason"]')?.textContent || '';
                if (task.trim()) {
                    data.incomplete_tasks.push({
                        task: task.trim(),
                        expected: expected.trim(),
                        reason: reason.trim()
                    });
                }
            });

            // æ”¶é›†åŠ¨æœºä¸æ–¹å‘
            const motivationItems = document.querySelectorAll('#reasons-list .editable-row [data-field="item"]');
            motivationItems.forEach(item => {
                const content = item.textContent?.trim();
                if (content) {
                    data.motivation_direction.push(content);
                }
            });

            // æ”¶é›†å†…éƒ¨åæ€
            const reflectionItems = document.querySelectorAll('#why-not-list .editable-row [data-field="item"]');
            reflectionItems.forEach(item => {
                const content = item.textContent?.trim();
                if (content) {
                    data.internal_reflection.push(content);
                }
            });

            // æ”¶é›†å¤–éƒ¨åé¦ˆ
            const feedbackItems = document.querySelectorAll('#achievements-list .editable-row');
            feedbackItems.forEach(item => {
                const source = item.querySelector('[data-field="source"]')?.textContent || '';
                const content = item.querySelector('[data-field="content"]')?.textContent || '';
                if (source.trim() && content.trim()) {
                    data.external_feedback.push({
                        source: source.trim(),
                        content: content.trim()
                    });
                }
            });

            // æ”¶é›†ä¸‹ä¸€æ­¥è®¡åˆ’
            const planRows = document.querySelectorAll('#next-steps-list .editable-row');
            planRows.forEach(row => {
                const task = row.querySelector('[data-field="task"]')?.textContent || '';
                const goal = row.querySelector('[data-field="goal"]')?.textContent || '';
                const priorityText = row.querySelector('[data-field="priority"]')?.textContent || 'P1';
                const priority = priorityText.startsWith('P') ? parseInt(priorityText.substring(1)) : 1;

                if (task.trim()) {
                    data.next_week_plan.push({
                        task: task.trim(),
                        priority: priority,
                        goal: goal.trim()
                    });
                }
            });

            return data;
        }

        // å¯ç”¨å†…è”ç¼–è¾‘
        function enableInlineEditing() {
            const editableElements = document.querySelectorAll('.editable-text');
            editableElements.forEach(element => {
                element.contentEditable = 'true';
                element.addEventListener('focus', handleEditStart);
                element.addEventListener('blur', handleEditEnd);
                element.addEventListener('keydown', handleKeyDown);
                element.addEventListener('input', handleInput);
            });

            const editableRows = document.querySelectorAll('.editable-row');
            editableRows.forEach(row => {
                row.addEventListener('click', handleRowClick);
            });

            const deleteButtons = document.querySelectorAll('.row-action-btn.delete');
            deleteButtons.forEach(button => {
                button.addEventListener('click', handleDeleteRow);
            });

            const addButtons = document.querySelectorAll('.add-row-btn');
            addButtons.forEach(button => {
                button.addEventListener('click', handleAddRow);
            });
        }

        // ç¦ç”¨å†…è”ç¼–è¾‘
        function disableInlineEditing() {
            const editingElements = document.querySelectorAll('.editable-text:focus');
            editingElements.forEach(element => {
                element.blur();
            });

            const editableElements = document.querySelectorAll('.editable-text');
            editableElements.forEach(element => {
                element.contentEditable = 'false';
                element.removeEventListener('focus', handleEditStart);
                element.removeEventListener('blur', handleEditEnd);
                element.removeEventListener('keydown', handleKeyDown);
                element.removeEventListener('input', handleInput);
            });

            const editableRows = document.querySelectorAll('.editable-row');
            editableRows.forEach(row => {
                row.removeEventListener('click', handleRowClick);
                row.classList.remove('selected');
            });
        }

        // å¤„ç†ç¼–è¾‘ç›¸å…³äº‹ä»¶
        function handleEditStart(e) {
            if (!isEditMode) return;
            const row = e.target.closest('.editable-row');
            if (row) {
                const allRows = document.querySelectorAll('.editable-row');
                allRows.forEach(r => r.classList.remove('selected'));
                row.classList.add('selected');
            }
        }

        function handleEditEnd(e) {
            // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ä¿å­˜é€»è¾‘
        }

        function handleInput(e) {
            // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å®æ—¶éªŒè¯
        }

        function handleKeyDown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                e.target.blur();
            }
            if (e.key === 'Escape') {
                e.target.blur();
            }
        }

        function handleRowClick(e) {
            if (!isEditMode) return;
            if (e.target.classList.contains('row-action-btn')) return;

            const allRows = document.querySelectorAll('.editable-row');
            allRows.forEach(row => row.classList.remove('selected'));
            e.currentTarget.classList.add('selected');
        }

        function handleDeleteRow(e) {
            e.stopPropagation();
            const row = e.target.closest('.editable-row');
            if (!row) return;

            const dataPath = row.getAttribute('data-path');
            const dataIndex = parseInt(row.getAttribute('data-index'));

            if (dataPath && dataIndex !== undefined) {
                // è¿™é‡Œå¯ä»¥æ·»åŠ åˆ é™¤é€»è¾‘ï¼Œç°åœ¨åªæ˜¯ä»DOMä¸­ç§»é™¤
                row.remove();
                console.log(`Deleted ${dataPath}[${dataIndex}]`);
            }
        }

        function handleAddRow(e) {
            const dataPath = e.target.getAttribute('data-path');
            if (!dataPath) return;

            // è¿™é‡Œå¯ä»¥æ·»åŠ æ–°å¢è¡Œé€»è¾‘
            console.log(`Add new row for ${dataPath}`);
        }

        // ç»´åº¦åˆ‡æ¢
        function toggleDimension(button) {
            const sectionName = button.getAttribute('data-section');
            const section = document.querySelector(`.report-section[data-section="${sectionName}"]`);

            if (section) {
                section.classList.toggle('hidden');
                button.classList.toggle('active');
            }
        }

        // ç»´åº¦æ§åˆ¶åŒºåŸŸåˆ‡æ¢
        function toggleDimensionControls() {
            const controls = document.querySelector('.dimension-controls');
            controls.classList.toggle('hidden');
        }

        // åˆå§‹åŒ–åé¦ˆæŒ‰é’®
        function initializeFeedbackButtons() {
            const sections = ['motivation', 'completed', 'incomplete', 'internal', 'external', 'next-steps'];
            sections.forEach(section => {
                const feedbackContainer = document.getElementById(`feedback-${section}`);
                if (feedbackContainer) {
                    const thumbsUpSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M7 10v12m8-8.5V2c0-.83-.67-1.5-1.5-1.5h-.5a2 2 0 0 0-2 2v7H2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8a2 2 0 0 0-2-2z"></path>
                    </svg>`;

                    const thumbsDownSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 14V2m-8 8.5v11.5c0 .83.67 1.5 1.5 1.5h.5a2 2 0 0 1 2-2v-7h7a2 2 0 0 1 2-2v-8a2 2 0 0 1-2-2h-12a2 2 0 0 1-2 2v8a2 2 0 0 1 2 2z"></path>
                    </svg>`;

                    feedbackContainer.innerHTML = `
                        <button class="feedback-btn" onclick="giveFeedback('${section}', 'like')" title="æœ‰å¸®åŠ©">
                            ${thumbsUpSvg}
                        </button>
                        <button class="feedback-btn" onclick="giveFeedback('${section}', 'dislike')" title="æ²¡å¸®åŠ©">
                            ${thumbsDownSvg}
                        </button>
                    `;
                }
            });
        }

        // åé¦ˆåŠŸèƒ½
        function giveFeedback(sectionName, feedbackType) {
            const section = document.querySelector(`.report-section[data-section="${sectionName}"]`);
            if (!section) return;

            const likeBtn = section.querySelector('.feedback-btn[onclick*="like"]');
            const dislikeBtn = section.querySelector('.feedback-btn[onclick*="dislike"]');

            likeBtn.classList.remove('liked');
            dislikeBtn.classList.remove('disliked');

            if (feedbackType === 'like') {
                likeBtn.classList.add('liked');
                console.log(`ç”¨æˆ·å¯¹ ${sectionName} ç»´åº¦ç‚¹èµ`);
            } else if (feedbackType === 'dislike') {
                dislikeBtn.classList.add('disliked');
                console.log(`ç”¨æˆ·å¯¹ ${sectionName} ç»´åº¦ç‚¹è¸©`);
            }

            showFeedbackToast();
            if (event) event.stopPropagation();
        }

        // æ˜¾ç¤ºåé¦ˆæç¤º
        function showFeedbackToast() {
            const existingToast = document.querySelector('.feedback-toast');
            if (existingToast) {
                existingToast.remove();
            }

            const toast = document.createElement('div');
            toast.className = 'feedback-toast';
            toast.textContent = 'Thank you for your feedback';
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 2000);
        }

        // ç¼–è¾‘çŠ¶æ€
        function editStatus(cellElement, event) {
            if (event) {
                event.stopPropagation();
            }

            const currentText = cellElement.textContent;
            const projectId = cellElement.getAttribute('data-project');

            cellElement.classList.add('editing');
            cellElement.contentEditable = 'true';
            cellElement.focus();

            // é€‰ä¸­æ‰€æœ‰æ–‡æœ¬
            const selection = window.getSelection();
            const range = document.createRange();
            range.selectNodeContents(cellElement);
            selection.removeAllRanges();
            selection.addRange(range);

            async function saveEdit() {
                const newText = cellElement.textContent.trim();
                if (newText && newText !== currentText) {
                    try {
                        // è°ƒç”¨APIä¿å­˜çŠ¶æ€æ›´æ–°
                        const response = await apiCall(`/projects/${projectId}/status`, {
                            method: 'PUT',
                            body: JSON.stringify({ status: newText })
                        });
                        if (response && response.success) {
                            cellElement.textContent = newText;
                            console.log(`Status updated for ${projectId}: ${newText}`);
                            showToast('çŠ¶æ€æ›´æ–°æˆåŠŸ', 'success');
                        } else {
                            cellElement.textContent = currentText;
                            showToast('çŠ¶æ€æ›´æ–°å¤±è´¥', 'error');
                        }
                    } catch (error) {
                        console.error('Failed to update status:', error);
                        cellElement.textContent = currentText;
                        showToast('çŠ¶æ€æ›´æ–°å¤±è´¥', 'error');
                    }
                } else {
                    cellElement.textContent = currentText;
                }
                cellElement.classList.remove('editing');
                cellElement.contentEditable = 'false';
            }

            function cancelEdit() {
                cellElement.textContent = currentText;
                cellElement.classList.remove('editing');
                cellElement.contentEditable = 'false';
            }

            cellElement.addEventListener('blur', saveEdit, { once: true });
            cellElement.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    saveEdit();
                } else if (e.key === 'Escape') {
                    cancelEdit();
                }
            }, { once: true });

            cellElement.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        }

        // æ–‡ä»¶é€‰æ‹©ç›‘å¬
        document.getElementById('fileInput').addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                document.getElementById('fileName').textContent = e.target.files[0].name;
            }
        });

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            isEditMode = false;
            const container = document.querySelector('.container');
            container.classList.remove('edit-mode');

            // åŠ è½½é¡¹ç›®åˆ—è¡¨
            await loadProjects();
        });
    </script>
</body>
</html>
